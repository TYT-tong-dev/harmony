<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ‰«ç ç‚¹é¤ - {{ table_number }}å·æ¡Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            max-width: 360px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .icon { font-size: 64px; margin-bottom: 20px; }
        .table-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 28px;
            font-weight: bold;
            padding: 12px 36px;
            border-radius: 50px;
            margin-bottom: 16px;
        }
        h1 { font-size: 22px; color: #333; margin-bottom: 8px; }
        .subtitle { color: #666; font-size: 14px; margin-bottom: 24px; }
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 12px;
            text-decoration: none;
            transition: transform 0.2s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .tip { font-size: 12px; color: #999; margin-top: 16px; line-height: 1.6; }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        /* å¾®ä¿¡æç¤ºé®ç½© */
        .wechat-mask {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 999;
            display: none;
            padding: 20px;
        }
        .wechat-mask.show { display: block; }
        .wechat-tip {
            color: white;
            text-align: right;
            padding: 20px;
        }
        .wechat-tip .arrow { font-size: 50px; animation: bounce 1s infinite; }
        .wechat-tip p { font-size: 20px; margin-top: 10px; font-weight: bold; }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <!-- å¾®ä¿¡/æ”¯ä»˜å®å†…æ‰“å¼€æç¤º -->
    <div class="wechat-mask" id="wechatMask">
        <div class="wechat-tip">
            <div class="arrow">â†—ï¸</div>
            <p>è¯·ç‚¹å‡»å³ä¸Šè§’ Â·Â·Â· </p>
            <p>é€‰æ‹©ã€Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€</p>
            <p style="margin-top:30px;font-size:14px;font-weight:normal;">å³å¯æ‰“å¼€ç‚¹é¤App</p>
        </div>
    </div>

    <div class="card">
        <div class="icon">ğŸ½ï¸</div>
        <div class="table-badge">{{ table_number }}å·æ¡Œ</div>
        <h1>æ¬¢è¿å…‰ä¸´</h1>

        <div id="loadingSection">
            <div class="spinner"></div>
            <p class="subtitle">æ­£åœ¨æ‰“å¼€ç‚¹é¤App...</p>
        </div>

        <div id="buttonSection" style="display:none;">
            <p class="subtitle">Appæœªå®‰è£…ï¼Œè¯·å…ˆä¸‹è½½</p>
            <a href="{{ download_url }}" class="btn btn-primary">
                â¬‡ï¸ ä¸‹è½½ç‚¹é¤App
            </a>
            <a href="javascript:void(0)" class="btn" style="background:#f0f0f0;color:#333;" onclick="openApp()">
                ğŸ”„ å·²å®‰è£…ï¼Ÿç‚¹å‡»é‡è¯•
            </a>
        </div>

        <p class="tip">é¦–æ¬¡ä½¿ç”¨è¯·å…ˆä¸‹è½½App</p>
    </div>

    <script>
        const tableId = "{{ table_id }}";
        // ä¿®æ”¹ä¸ºè·³è½¬åˆ°entryåº”ç”¨çš„Indexé¡µé¢
        const deepLink = "catering-app://table?tableId=" + encodeURIComponent(tableId) + "&mode=customer";

        // æ£€æµ‹æ˜¯å¦åœ¨å¾®ä¿¡/æ”¯ä»˜å®ä¸­
        function isWechatOrAlipay() {
            return /micromessenger|alipay/i.test(navigator.userAgent);
        }

        function showButtons() {
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('buttonSection').style.display = 'block';
        }

        function openApp() {
            if (isWechatOrAlipay()) {
                document.getElementById('wechatMask').classList.add('show');
                return;
            }

            // ç›´æ¥è·³è½¬åˆ°App
            window.location.href = deepLink;

            // 3ç§’åå¦‚æœè¿˜åœ¨é¡µé¢ï¼Œè¯´æ˜Appæœªå®‰è£…
            setTimeout(showButtons, 3000);
        }

        // ç‚¹å‡»é®ç½©å…³é—­
        document.getElementById('wechatMask').onclick = function(e) {
            if (e.target === this) {
                this.classList.remove('show');
            }
        };

        // é¡µé¢åŠ è½½åè‡ªåŠ¨å°è¯•æ‰“å¼€App
        window.onload = function() {
            setTimeout(openApp, 500);
        };
    </script>
</body>
</html>

