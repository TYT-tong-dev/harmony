// ScanTablePage.ets - æ‰«ç /è¾“å…¥æ¡Œå·é¡µé¢
import router from '@ohos.router';
import { CustomerToastUtils } from '../common/CustomerUtils';

@Entry
@Component
struct ScanTablePage {
  @State tableNumber: string = '';
  @State isScanning: boolean = false;

  build() {
    Column() {
      // é¡¶éƒ¨LogoåŒºåŸŸ
      Column() {
        Text('ğŸ½')
          .fontSize(60)
          .margin({ top: 60 })
        
        Text('é£Ÿå…‰è®°')
          .fontSize(28)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
          .margin({ top: 16 })
        
        Text('æ‰«ç ç‚¹é¤ Â· ç¾å‘³å³è¾¾')
          .fontSize(14)
          .fontColor('#999999')
          .margin({ top: 8 })
      }
      .width('100%')
      .alignItems(HorizontalAlign.Center)

      Blank()

      // æ‰«ç åŒºåŸŸ
      Column({ space: 20 }) {
        // æ‰«ç æŒ‰é’®
        Button({ type: ButtonType.Normal }) {
          Row({ space: 8 }) {
            Text('ğŸ“·').fontSize(20)
            Text('æ‰«ææ¡Œå·äºŒç»´ç ').fontSize(16).fontColor('#FFFFFF')
          }
        }
        .width('80%')
        .height(50)
        .borderRadius(25)
        .backgroundColor('#007DFF')
        .onClick(() => {
          this.startScan();
        })

        // åˆ†éš”çº¿
        Row() {
          Divider().width('35%').color('#E0E0E0')
          Text('æˆ–').fontSize(12).fontColor('#999999').margin({ left: 12, right: 12 })
          Divider().width('35%').color('#E0E0E0')
        }
        .width('80%')
        .justifyContent(FlexAlign.Center)

        // æ‰‹åŠ¨è¾“å…¥æ¡Œå·
        Column({ space: 12 }) {
          Text('æ‰‹åŠ¨è¾“å…¥æ¡Œå·')
            .fontSize(14)
            .fontColor('#666666')

          TextInput({ placeholder: 'è¯·è¾“å…¥æ¡Œå·ï¼Œå¦‚ A01' })
            .width('80%')
            .height(48)
            .borderRadius(8)
            .backgroundColor('#F5F7FA')
            .textAlign(TextAlign.Center)
            .fontSize(18)
            .onChange((value: string) => {
              this.tableNumber = value.toUpperCase();
            })

          Button('ç¡®è®¤å…¥åº§', { type: ButtonType.Normal })
            .width('80%')
            .height(48)
            .borderRadius(24)
            .backgroundColor(this.tableNumber.length > 0 ? '#007DFF' : '#CCCCCC')
            .enabled(this.tableNumber.length > 0)
            .onClick(() => {
              this.confirmTable();
            })
        }
      }
      .width('100%')
      .alignItems(HorizontalAlign.Center)

      Blank()

      // åº•éƒ¨æç¤º
      Text('è¯·æ‰«æé¤æ¡Œä¸Šçš„äºŒç»´ç å¼€å§‹ç‚¹é¤')
        .fontSize(12)
        .fontColor('#AAAAAA')
        .margin({ bottom: 40 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#FFFFFF')
  }

  private startScan(): void {
    // TODO: è°ƒç”¨ç³»ç»Ÿæ‰«ç èƒ½åŠ›
    // åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨ @kit.ScanKit è¿›è¡Œæ‰«ç 
    CustomerToastUtils.show('æ­£åœ¨æ‰“å¼€æ‰«ç ...');
    
    // æ¨¡æ‹Ÿæ‰«ç ç»“æœ
    setTimeout(() => {
      this.tableNumber = 'A01';
      this.confirmTable();
    }, 1000);
  }

  private confirmTable(): void {
    if (!this.tableNumber) {
      CustomerToastUtils.showError('è¯·è¾“å…¥æ¡Œå·');
      return;
    }

    // ä¿å­˜æ¡Œå·åˆ°AppStorage
    AppStorage.setOrCreate('tableId', this.tableNumber);
    AppStorage.setOrCreate('isCustomerMode', true);

    CustomerToastUtils.showSuccess(`å·²å…¥åº§ ${this.tableNumber} å·æ¡Œ`);

    // è·³è½¬åˆ°ç‚¹é¤é¦–é¡µ
    router.replaceUrl({
      url: 'pages/CustomerHomePage'
    });
  }
}

